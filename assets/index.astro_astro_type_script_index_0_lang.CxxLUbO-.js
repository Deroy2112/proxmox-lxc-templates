const k=new Map;function U(){const e=document.getElementById("search-input"),o=document.getElementById("template-grid"),m=document.getElementById("no-results"),g=o?.querySelectorAll(".app-card"),u=document.querySelectorAll("#category-pills .pill"),p=document.querySelectorAll(".sidebar-nav button[data-category]"),h=document.getElementById("visible-count");if(!o||!g)return;let i="all",l="";k.clear(),g.forEach(t=>{const c=t.getAttribute("data-template");if(c)try{const y=JSON.parse(c);k.set(y.name,y)}catch{}});const n=new URLSearchParams(window.location.search),a=n.get("q")||"",v=n.get("category")||"all";a&&e&&(e.value=a,l=a.toLowerCase()),i=v;function w(){u.forEach(t=>{const c=t.getAttribute("data-category");t.classList.toggle("active",c===i)}),p.forEach(t=>{const c=t.getAttribute("data-category");t.classList.toggle("active",c===i)})}function d(){let t=0;g.forEach(c=>{const y=c.getAttribute("data-name")||"",S=c.getAttribute("data-description")||"",b=c.getAttribute("data-category")||"",f=(!l||y.includes(l)||S.includes(l))&&(i==="all"||b===i);c.style.display=f?"":"none",f&&t++}),h&&(h.textContent=String(t)),m?.classList.toggle("hidden",t>0),o?.classList.toggle("hidden",t===0&&g.length>0)}let E;e?.addEventListener("input",()=>{clearTimeout(E),E=setTimeout(()=>{l=e.value.toLowerCase(),document.getElementById("template-detail")?.classList.contains("hidden")||T(),d();const t=new URL(window.location.href);l?t.searchParams.set("q",e.value):t.searchParams.delete("q"),history.replaceState(null,"",t.toString())},150)});function I(t){i=t,document.getElementById("template-detail")?.classList.contains("hidden")||T(),w(),d();const c=new URL(window.location.href);i!=="all"?c.searchParams.set("category",i):c.searchParams.delete("category"),history.replaceState(null,"",c.toString())}u.forEach(t=>{t.addEventListener("click",()=>{I(t.getAttribute("data-category")||"all")})}),p.forEach(t=>{t.addEventListener("click",()=>{I(t.getAttribute("data-category")||"all"),document.querySelector(".sidebar")?.classList.remove("open"),document.getElementById("sidebar-overlay")?.classList.remove("open")})}),w(),d()}function F(e){A(e),document.getElementById("template-list")?.classList.add("hidden"),document.getElementById("template-detail")?.classList.remove("hidden");const o=new URL(location.href);o.searchParams.set("template",e.name),o.searchParams.delete("q"),o.searchParams.delete("category"),history.pushState({template:e.name},"",o),window.scrollTo({top:0,behavior:"smooth"})}function T(){document.getElementById("template-detail")?.classList.add("hidden"),document.getElementById("template-list")?.classList.remove("hidden");const e=new URL(location.href);e.searchParams.delete("template"),history.pushState({},"",e)}function r(e){const o=document.createElement("div");return o.textContent=e,o.innerHTML}function A(e){const o=`https://cdn.jsdelivr.net/gh/homarr-labs/dashboard-icons@main/svg/${e.icon}.svg`,m=e.name.charAt(0).toUpperCase()+e.name.slice(1),g=document.getElementById("detail-icon");g&&(g.src=o);const u=document.getElementById("detail-name");u&&(u.textContent=m);const p=document.getElementById("detail-description");p&&(p.textContent=e.description);const h=document.getElementById("detail-badges");h&&(h.innerHTML=`
        <span class="badge badge-success">v${e.version}-${e.build_version}</span>
        <span class="tag">${e.base_os}</span>
        <span class="badge badge-info">${e.category}</span>
      `);const i=document.getElementById("detail-download-section"),l=document.getElementById("detail-wget"),n=document.getElementById("detail-sha512");if(e.download_url){i?.classList.remove("hidden"),l&&(l.value=`wget ${e.download_url}`);const s=document.getElementById("detail-sha512-wrapper");n&&s&&(e.sha512?(n.value=`SHA512: ${e.sha512}`,n.setAttribute("data-sha512",e.sha512),s.classList.remove("hidden")):(n.value="",s.classList.add("hidden")))}else i?.classList.add("hidden");const a=document.getElementById("detail-quickstart-section"),v=document.getElementById("detail-quickstart");e.quick_start&&a&&v?(a.classList.remove("hidden"),v.innerHTML=`<pre><code>${r(e.quick_start)}</code></pre>`):a?.classList.add("hidden");const w=document.getElementById("detail-resources"),d=e.resources;if(w&&d){const s=d.memory_recommended,B=d.memory_min;w.innerHTML=`
        <div class="stat">
          <div class="stat-value">${s>=1024?s/1024+"GB":s+"MB"}</div>
          <div class="stat-label">Memory</div>
          <div class="stat-desc">min: ${B>=1024?B/1024+"GB":B+"MB"}</div>
        </div>
        <div class="stat">
          <div class="stat-value">${d.disk_recommended}</div>
          <div class="stat-label">Disk</div>
          <div class="stat-desc">min: ${d.disk_min}</div>
        </div>
        <div class="stat">
          <div class="stat-value">${d.cores}</div>
          <div class="stat-label">${d.cores===1?"Core":"Cores"}</div>
        </div>
      `}const E=document.getElementById("detail-ports-section"),I=document.getElementById("detail-ports"),t=e.ports;t?.length&&E&&I?(E.classList.remove("hidden"),I.innerHTML=t.map(s=>`<tr><td class="font-mono">${s.port}</td><td>${r(s.description)}</td></tr>`).join("")):E?.classList.add("hidden");const c=document.getElementById("detail-paths-section"),y=document.getElementById("detail-paths"),S=e.paths;S?.length&&c&&y?(c.classList.remove("hidden"),y.innerHTML=S.map(s=>`<tr><td class="font-mono text-xs">${r(s.path)}</td><td>${r(s.description)}</td></tr>`).join("")):c?.classList.add("hidden");const b=document.getElementById("detail-credentials-section"),C=document.getElementById("detail-credentials"),L=e.credentials;if(L&&b&&C){b.classList.remove("hidden");let s=`User: <code>${r(L.username)}</code> / Pass: <code>${r(L.password)}</code>`;L.note&&(s+=`<br><span class="text-muted">${r(L.note)}</span>`),C.innerHTML=s}else b?.classList.add("hidden");const f=document.getElementById("detail-faq-section"),$=document.getElementById("detail-faq"),M=e.faq;M?.length&&f&&$?(f.classList.remove("hidden"),$.innerHTML=M.map((s,B)=>`
        <div class="accordion-item ${B===0?"open":""}">
          <button class="accordion-header">
            ${r(s.question)}
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor">
              <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z" />
            </svg>
          </button>
          <div class="accordion-content"><p>${r(s.answer)}</p></div>
        </div>
      `).join(""),$.querySelectorAll(".accordion-header").forEach(s=>{s.addEventListener("click",()=>{s.parentElement?.classList.toggle("open")})})):f?.classList.add("hidden");const q=document.getElementById("detail-changelog-section"),_=document.getElementById("detail-changelog"),N=document.getElementById("changelog-item"),K=document.getElementById("changelog-toggle");e.changelog&&q&&_?(q.classList.remove("hidden"),_.innerHTML=`<p>${r(e.changelog).replace(/\n/g,"<br>")}</p>`,K?.addEventListener("click",()=>{N?.classList.toggle("open")})):q?.classList.add("hidden");const x=document.getElementById("detail-release-section"),H=document.getElementById("detail-release-date"),P=document.getElementById("detail-github-link");e.release_url||e.release_date?(x?.classList.remove("hidden"),e.release_date&&H&&(H.textContent=`Released: ${new Date(e.release_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}`),e.release_url&&P&&(P.href=e.release_url)):x?.classList.add("hidden")}function D(){const o=document.getElementById("template-grid")?.querySelectorAll(".app-card"),m=document.getElementById("back-to-list"),g=document.getElementById("detail-wget-copy"),u=document.getElementById("detail-wget"),p=document.getElementById("detail-sha512-copy");g?.addEventListener("click",async()=>{if(u?.value)try{await navigator.clipboard.writeText(u.value),window.showToast?.("Copied to clipboard!")}catch{u.select(),document.execCommand("copy"),window.showToast?.("Copied!")}}),p?.addEventListener("click",async()=>{const a=document.getElementById("detail-sha512")?.getAttribute("data-sha512");if(a)try{await navigator.clipboard.writeText(a),window.showToast?.("SHA512 copied to clipboard!")}catch{window.showToast?.("Failed to copy")}});function h(n){const a=n.getAttribute("data-template");if(a)try{const v=JSON.parse(a);F(v)}catch{}}o?.forEach(n=>{n.addEventListener("click",()=>h(n)),n.addEventListener("keydown",a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),h(n))})}),m?.addEventListener("click",T),window.addEventListener("popstate",n=>{if(n.state?.template){const a=k.get(n.state.template);a&&(A(a),document.getElementById("template-list")?.classList.add("hidden"),document.getElementById("template-detail")?.classList.remove("hidden"))}else document.getElementById("template-detail")?.classList.add("hidden"),document.getElementById("template-list")?.classList.remove("hidden")});const l=new URLSearchParams(location.search).get("template");if(l){const n=k.get(l);n&&(A(n),document.getElementById("template-list")?.classList.add("hidden"),document.getElementById("template-detail")?.classList.remove("hidden"))}}function R(){const e=document.getElementById("menu-toggle"),o=document.querySelector(".sidebar"),m=document.getElementById("sidebar-overlay");e?.addEventListener("click",()=>{o?.classList.toggle("open"),m?.classList.toggle("open")}),m?.addEventListener("click",()=>{o?.classList.remove("open"),m?.classList.remove("open")})}function j(){document.addEventListener("keydown",e=>{(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),document.getElementById("search-input")?.focus())})}U();D();R();j();document.addEventListener("astro:after-swap",()=>{U(),D(),R(),j()});
