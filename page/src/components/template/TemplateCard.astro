---
interface Props {
  name: string;
  description: string;
  category: string;
  icon: string;
  version: string;
  build_version: number;
  base_os: string;
  memory_min: number;
  index?: number;
  templateData: string;
}

const {
  name,
  description,
  category,
  icon,
  version,
  build_version,
  base_os,
  memory_min,
  index = 0,
  templateData,
} = Astro.props;

const iconUrl = `https://cdn.jsdelivr.net/gh/homarr-labs/dashboard-icons@main/svg/${icon}.svg`;
const delay = Math.min(index * 0.05, 0.5);
const displayName = name.charAt(0).toUpperCase() + name.slice(1);

// Map categories to DaisyUI badge colors
const categoryBadge: Record<string, string> = {
  media: "badge-error",
  network: "badge-info",
  database: "badge-warning",
  automation: "badge-secondary",
  monitoring: "badge-success",
  storage: "badge-accent",
  security: "badge-primary",
  development: "badge-neutral",
};
---

<div
  class="template-card card glass hover:shadow-xl transition-all hover:-translate-y-1 animate-fade-in cursor-pointer"
  style={`animation-delay: ${delay}s; opacity: 0;`}
  data-category={category}
  data-name={name.toLowerCase()}
  data-description={description.toLowerCase()}
  data-template={templateData}
  role="button"
  tabindex="0"
>
  <div class="card-body p-5">
    <div class="flex items-start gap-4">
      <!-- Icon -->
      <div class="avatar placeholder">
        <div class="bg-base-300 rounded-xl w-14 p-3">
          <img
            src={iconUrl}
            alt=""
            loading="lazy"
            class="w-full h-full"
            onerror="this.style.display='none';this.nextElementSibling.style.display='block'"
          />
          <svg class="w-full h-full opacity-50" style="display:none" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-1 12H5c-.55 0-1-.45-1-1V9c0-.55.45-1 1-1h14c.55 0 1 .45 1 1v8c0 .55-.45 1-1 1z"/>
          </svg>
        </div>
      </div>

      <!-- Content -->
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2 mb-1">
          <h3 class="font-bold truncate">{displayName}</h3>
          <span class="badge badge-ghost badge-sm">v{version}</span>
        </div>
        <p class="text-sm opacity-70 line-clamp-2 mb-3">{description}</p>
        <div class="flex items-center gap-3 text-xs opacity-50">
          <span class="flex items-center gap-1">
            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/>
            </svg>
            {base_os}
          </span>
          <span class="flex items-center gap-1">
            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15 9H9v6h6V9zm-2 4h-2v-2h2v2zm8-2V9h-2V7c0-1.1-.9-2-2-2h-2V3h-2v2h-2V3H9v2H7c-1.1 0-2 .9-2 2v2H3v2h2v2H3v2h2v2c0 1.1.9 2 2 2h2v2h2v-2h2v2h2v-2h2c1.1 0 2-.9 2-2v-2h2v-2h-2v-2h2zm-4 6H7V7h10v10z"/>
            </svg>
            {memory_min} MB
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
