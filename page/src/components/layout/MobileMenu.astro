---
interface Props {
  class?: string;
}

const { class: className = "" } = Astro.props;
---

<!-- Mobile Menu Button -->
<button
  type="button"
  id="mobile-menu-btn"
  class={`mobile-menu-btn ${className}`}
  aria-label="Open menu"
  aria-expanded="false"
>
  <svg class="hamburger-icon w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <line x1="3" y1="6" x2="21" y2="6"></line>
    <line x1="3" y1="12" x2="21" y2="12"></line>
    <line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
  <svg class="close-icon w-6 h-6 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>

<!-- Overlay -->
<div id="mobile-overlay" class="mobile-overlay"></div>

<style>
  .mobile-menu-btn {
    display: none;
    position: fixed;
    top: 1rem;
    left: 1rem;
    z-index: 50;
    padding: 0.5rem;
    border-radius: 0.5rem;
    background: var(--glass-bg);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    transition: all 200ms ease;
  }

  .mobile-menu-btn:hover {
    background: var(--bg-tertiary);
  }

  .mobile-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    z-index: 35;
    opacity: 0;
    transition: opacity 300ms ease;
  }

  .mobile-overlay.visible {
    opacity: 1;
  }

  @media (max-width: 768px) {
    .mobile-menu-btn {
      display: flex;
    }

    .mobile-overlay.open {
      display: block;
    }
  }
</style>

<script>
  function initMobileMenu() {
    const btn = document.getElementById("mobile-menu-btn");
    const overlay = document.getElementById("mobile-overlay");
    const sidebar = document.querySelector(".sidebar");
    const hamburger = btn?.querySelector(".hamburger-icon");
    const closeIcon = btn?.querySelector(".close-icon");

    if (!btn || !overlay || !sidebar) return;

    let isOpen = false;

    function toggle(open?: boolean) {
      isOpen = open ?? !isOpen;

      sidebar.classList.toggle("open", isOpen);
      overlay.classList.toggle("open", isOpen);
      btn.setAttribute("aria-expanded", String(isOpen));
      document.body.classList.toggle("overflow-hidden", isOpen);

      // Toggle icons
      hamburger?.classList.toggle("hidden", isOpen);
      closeIcon?.classList.toggle("hidden", !isOpen);

      // Animate overlay
      if (isOpen) {
        requestAnimationFrame(() => {
          overlay.classList.add("visible");
        });
      } else {
        overlay.classList.remove("visible");
      }
    }

    btn.addEventListener("click", () => toggle());
    overlay.addEventListener("click", () => toggle(false));

    // Close on escape
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && isOpen) {
        toggle(false);
      }
    });

    // Close on navigation
    sidebar.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", () => {
        if (window.innerWidth <= 768) {
          toggle(false);
        }
      });
    });
  }

  initMobileMenu();
  document.addEventListener("astro:after-swap", initMobileMenu);
</script>
