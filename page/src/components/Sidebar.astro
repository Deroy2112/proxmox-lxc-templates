---
import Logo from "./Logo.astro";
import SearchBox from "./SearchBox.astro";

interface Category {
  name: string;
  label: string;
  count?: number;
}

interface Props {
  categories?: Category[];
  activeCategory?: string;
  totalCount?: number;
}

const { categories = [], activeCategory = "all", totalCount = 0 } = Astro.props;
const basePath = import.meta.env.BASE_URL;
---

<aside class="sidebar" id="sidebar">
  <!-- Header with Logo + Title -->
  <div class="sidebar-header">
    <a href={basePath} class="logo">
      <Logo variant="white" />
      <span class="logo-text">Proxmox LXC Templates</span>
    </a>
  </div>

  <!-- Search -->
  <div class="sidebar-search">
    <SearchBox id="search-input" placeholder="Search templates..." />
  </div>

  <!-- Navigation -->
  <nav class="sidebar-nav">
    <!-- Discover -->
    <div class="nav-section">
      <div class="nav-section-title">Discover</div>
      <button
        class:list={["nav-item", { active: activeCategory === "all" }]}
        data-category="all"
      >
        <!-- Grid Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor">
          <path d="M104,40H56A16,16,0,0,0,40,56v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V56A16,16,0,0,0,104,40Zm0,64H56V56h48v48Zm96-64H152a16,16,0,0,0-16,16v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V56A16,16,0,0,0,200,40Zm0,64H152V56h48v48Zm-96,32H56a16,16,0,0,0-16,16v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V152A16,16,0,0,0,104,136Zm0,64H56V152h48v48Zm96-64H152a16,16,0,0,0-16,16v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V152A16,16,0,0,0,200,136Zm0,64H152V152h48v48Z" />
        </svg>
        All Templates
        <span class="nav-item-count" data-count="all">{totalCount}</span>
      </button>
    </div>

    <!-- Categories -->
    <div class="nav-section">
      <div class="nav-section-title">Categories</div>
      {categories.map((cat) => (
        <button
          class:list={["nav-item", { active: activeCategory === cat.name }]}
          data-category={cat.name}
        >
          <!-- Category Icon based on name -->
          {cat.name === "media" && (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor">
              <path d="M164.44,105.34l-48-32A8,8,0,0,0,104,80v64a8,8,0,0,0,12.44,6.66l48-32a8,8,0,0,0,0-13.32ZM120,129.05V95l25.58,17ZM216,40H40A16,16,0,0,0,24,56V168a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,128H40V56H216V168Zm16,40a8,8,0,0,1-8,8H32a8,8,0,0,1,0-16H224A8,8,0,0,1,232,208Z" />
            </svg>
          )}
          {cat.name === "network" && (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor">
              <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm88,104a87.62,87.62,0,0,1-6.4,32.94l-44.7-27.49a15.92,15.92,0,0,0-6.24-2.23l-22.82-3.08a16.11,16.11,0,0,0-16,7.86h-8.72l-3.8-7.86a15.91,15.91,0,0,0-11-8.67l-8-1.73L96.14,104h16.71a16.06,16.06,0,0,0,7.73-2l12.25-6.76a16.62,16.62,0,0,0,3-2.14l26.91-24.34A15.93,15.93,0,0,0,166,49.1l-.36-.65A88.11,88.11,0,0,1,216,128Z" />
            </svg>
          )}
          {cat.name === "database" && (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor">
              <path d="M128,24C74.17,24,32,48.6,32,80v96c0,31.4,42.17,56,96,56s96-24.6,96-56V80C224,48.6,181.83,24,128,24Zm0,16c44.45,0,80,19.31,80,40s-35.55,40-80,40S48,100.69,48,80,83.55,40,128,40Zm0,176c-44.45,0-80-19.31-80-40V118.87C68.29,133.89,96.21,144,128,144s59.71-10.11,80-25.13V176C208,196.69,172.45,216,128,216Z" />
            </svg>
          )}
          {cat.name === "automation" && (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor">
              <path d="M219.31,108.68l-80-80a16,16,0,0,0-22.62,0l-80,80A15.87,15.87,0,0,0,32,120v96a8,8,0,0,0,8,8h64a8,8,0,0,0,8-8V168h32v48a8,8,0,0,0,8,8h64a8,8,0,0,0,8-8V120A15.87,15.87,0,0,0,219.31,108.68ZM208,208H160V160a8,8,0,0,0-8-8H104a8,8,0,0,0-8,8v48H48V120l80-80,80,80Z" />
            </svg>
          )}
          {cat.name === "monitoring" && (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor">
              <path d="M232,208a8,8,0,0,1-8,8H32a8,8,0,0,1-8-8V48a8,8,0,0,1,16,0V156.69l50.34-50.35a8,8,0,0,1,11.32,0L128,132.69,180.69,80H160a8,8,0,0,1,0-16h40a8,8,0,0,1,8,8v40a8,8,0,0,1-16,0V91.31l-58.34,58.35a8,8,0,0,1-11.32,0L96,123.31,40,179.31V200H224A8,8,0,0,1,232,208Z" />
            </svg>
          )}
          {cat.name === "storage" && (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor">
              <path d="M216,72H56a8,8,0,0,1,0-16H192a8,8,0,0,0,0-16H56A24,24,0,0,0,32,64V192a24,24,0,0,0,24,24H216a16,16,0,0,0,16-16V88A16,16,0,0,0,216,72Zm0,128H56a8,8,0,0,1-8-8V86.63A23.84,23.84,0,0,0,56,88H216Zm-48-56a12,12,0,1,1,12,12A12,12,0,0,1,168,144Z" />
            </svg>
          )}
          {cat.name === "security" && (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor">
              <path d="M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96ZM208,208H48V96H208V208Zm-80-96a28,28,0,0,0-8,54.83V184a8,8,0,0,0,16,0V166.83A28,28,0,0,0,128,112Zm0,40a12,12,0,1,1,12-12A12,12,0,0,1,128,152Z" />
            </svg>
          )}
          {cat.name === "development" && (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor">
              <path d="M69.12,94.15,28.5,128l40.62,33.85a8,8,0,1,1-10.24,12.29l-48-40a8,8,0,0,1,0-12.29l48-40a8,8,0,0,1,10.24,12.3Zm176,27.7-48-40a8,8,0,1,0-10.24,12.3L227.5,128l-40.62,33.85a8,8,0,1,0,10.24,12.29l48-40a8,8,0,0,0,0-12.29ZM162.73,32.48a8,8,0,0,0-10.25,4.79l-64,176a8,8,0,0,0,4.79,10.26A8.14,8.14,0,0,0,96,224a8,8,0,0,0,7.52-5.27l64-176A8,8,0,0,0,162.73,32.48Z" />
            </svg>
          )}
          {/* Fallback icon for unknown categories */}
          {!["media", "network", "database", "automation", "monitoring", "storage", "security", "development"].includes(cat.name) && (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor">
              <path d="M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,160H40V56H216V200Z" />
            </svg>
          )}
          {cat.label}
          <span class="nav-item-count" data-count={cat.name}>{cat.count || 0}</span>
        </button>
      ))}
    </div>
  </nav>

  <!-- Footer (empty, can be used for version info etc.) -->
  <div class="sidebar-footer"></div>
</aside>

<style>
  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
    color: var(--text-primary);
  }

  .logo-text {
    font-size: 0.875rem;
    font-weight: 600;
    white-space: nowrap;
  }
</style>
